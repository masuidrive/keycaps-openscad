name: Generate and Deploy OpenSCAD preview to GitHub Pages

on:
  push:
    paths:
      - "**.scad"

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install OpenSCAD
        run: sudo apt-get install -y openscad

      - name: Generate STL files
        run: |
          for scad in $(ls *.scad); do
              openscad -o ${scad%.scad}.stl $scad
          done

      - name: Deploy to GitHub Pages
        run: |
          git checkout -b gh-pages
          git add *.stl
          git commit -m "Update STL files generated by GitHub Actions"
          git push -f origin gh-pages
