name: Generate and Deploy OpenSCAD preview to GitHub Pages

on:
  push:
    paths:
      - "**/*.scad"

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install OpenSCAD
        run: sudo apt-get install -y openscad

      - name: Generate STL files
        run: |
          find . -name "*.scad" | grep -v "^./lib/" | while read scad; do
              stl_path="${scad%.scad}.stl"
              openscad -o $stl_path $scad
          done

      - name: Deploy to GitHub Pages
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "<email>@users.noreply.github.com"
          git checkout -b gh-pages
          git add ./*.stl **/*.stl
          git commit -m "Update STL files generated by GitHub Actions"
          git push -f origin gh-pages
